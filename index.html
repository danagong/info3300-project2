<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 2</title>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <link
    href="https://fonts.googleapis.com/css?family=Aldrich|Arima+Madurai|Open Sans|Libre+Baskerville|Pirata+One|Poiret+One|Sancreek|Satisfy|Share+Tech+Mono|Smokum|Snowburst+One|Special+Elite"
    rel="stylesheet">
    <style>
      body{
        font-family: "Open Sans";
      }
    </style>

</head>
<body>
  <h3> Trees and Air Quality in an Urban World</h3>
    <svg id="nyc-choropleth" height="600" width="900" >
    </svg>
</body>

<script>
const svg = d3.select("#nyc-choropleth");
  const width = svg.attr("width");
  const height = svg.attr("height");
  const margin = { top: 20, right: 20, bottom: 20, left:20};
  const mapWidth = width - margin.left - margin.right;
  const mapHeight = height - margin.top - margin.bottom;
  const map = svg.append("g")
                  .attr("transform","translate("+margin.left+","+margin.top+")");


const requestData = async function() {


  const nyc = await d3.json("Community Districts.geojson");
  const trees = await d3.csv("trees.csv");
  console.log(nyc);
  console.log(trees);


  //var state = topojson.feature(nyc, nyc.objects.STATE);     // List of state outlines to fill
 // var stateMesh = topojson.mesh(nyc, nyc.objects.STATE);    // 'Mesh' of all outlines put together for a stroke
  //console.log(stateMesh)

  var projection = d3.geoAlbers()
    .fitSize([width, height], nyc)


  const path = d3.geoPath(projection);
  console.log(path)

  // creating NYC neighborhood/borough map
  var viewport = map.append("g");

  var areas = viewport.selectAll( "path" )
    .data( nyc.features )
    .enter()
    .append( "path" ) 
    .attr("class","outline")
    .style("stroke-width", 1)
    .style("opacity", ".9")
    .attr( "stroke", "#333")
    .attr("fill", (function (d) { 
    // Manhattan
    if(parseInt(d.properties.boro_cd)<=112 && parseInt(d.properties.boro_cd)>=101)
    
    {return "#F4A261"}
   
    // Staten Island
    if(parseInt(d.properties.boro_cd)<=503 && parseInt(d.properties.boro_cd)>=501)
    {return "#946E83"}

    // Bronx
    if(parseInt(d.properties.boro_cd)<=212 && parseInt(d.properties.boro_cd)>=201)
    {return "#FCE887"}

    // Brooklyn
    if(parseInt(d.properties.boro_cd)<=318 && parseInt(d.properties.boro_cd)>=301)
    {return "#A9C8E9"}

    // Queens
    if(parseInt(d.properties.boro_cd)<=414 && parseInt(d.properties.boro_cd)>=401)
    {return "#E76F51"}

    else {return "lightgrey"}
    } ))
    .attr( "d", path );

  viewport.selectAll(".pin")
    .data(trees)
    .enter().append("circle")
    .attr("class","circles")
    .attr("r",1 )
    .style("opacity", ".1")
    .attr("fill", "green")
    .attr("cx",function(d) { return projection([d["longitude"],d["latitude"]])[0];})
    .attr("cy",function(d) { return projection([d["longitude"],d["latitude"]])[1];});

  var zoom = d3.zoom()
               .scaleExtent([1,10])
               .on("zoom", mapZoomed);
  viewport.call(zoom);
  function mapZoomed({transform}) {     
    viewport.attr("transform", transform.toString());
    viewport.selectAll(".outline")
            .style("stroke-width", 1 / transform.k);
    viewport.selectAll(".circles")
            .style("r", radius(transform.k));
    viewport.selectAll(".circles")
            .style("opacity",  opa(transform.k));
  }
    
  function radius(k) {
    const rScale = d3.scaleLinear().domain([1, 10])
        .range([1, 0.5]);
    return rScale(k);
  }

  function opa(k) {
    const opaScale = d3.scaleLinear().domain([1, 10])
        .range([0.1, 0.3]);
    return opaScale(k);
  }

  const textbox = svg.append("g").attr("transform","translate(10,10)");
  areas.on("mouseover", function() {
    textbox.html('');
    current = d3.select(this);
    let title = d3.select(this).datum().properties.boro_cd;
    textbox.append("text").text(title)
      .attr("x", 700).attr("y", 500).attr("font-size","30px");
  });

  areas.on("mouseout", function() {
    textbox.html('');
    current = d3.select(this);
    current.attr("r", 3)
  });

};

requestData();
</script>
</html>